import{c as y,r as n,j as e,m as g,A as k,L as C,X as I,s as S}from"./index-Dck5GfTx.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=y("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]),E=({onScanSuccess:v,onClose:u})=>{const i=n.useRef(null),h=n.useRef(null),[m,j]=n.useState(null),[o,x]=n.useState(!1),[b,c]=n.useState(null);n.useEffect(()=>(f(),()=>p()),[]);const f=async()=>{c(null);try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});j(t),i.current&&(i.current.srcObject=t)}catch{c("Không thể truy cập Camera. Vui lòng cấp quyền.")}},p=()=>{m&&m.getTracks().forEach(t=>t.stop())},w=async()=>{if(!i.current||o)return;x(!0),c(null);const t=i.current,l=h.current;let s=t.videoWidth,r=t.videoHeight;const a=1920;s>r?s>a&&(r=Math.round(r*(a/s)),s=a):r>a&&(s=Math.round(s*(a/r)),r=a),l.width=s,l.height=r,l.getContext("2d").drawImage(t,0,0,s,r);const N=l.toDataURL("image/jpeg",.9),d=await S(N);d.error?(c(d.error),x(!1)):(navigator.vibrate&&navigator.vibrate(50),v(d),u())};return e.jsxs("div",{className:"fixed inset-0 bg-black z-[200] flex flex-col items-center justify-center p-4",children:[e.jsxs("div",{className:"relative w-full max-w-md aspect-[3/4] bg-stone-900 rounded-[32px] overflow-hidden shadow-2xl border border-white/10",children:[e.jsx("video",{ref:i,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"w-64 h-64 border-2 border-indigo-400/50 rounded-3xl relative",children:[e.jsx("div",{className:"absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-indigo-500 rounded-tl-xl"}),e.jsx("div",{className:"absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-indigo-500 rounded-tr-xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-indigo-500 rounded-bl-xl"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-indigo-500 rounded-br-xl"}),o&&e.jsx(g.div,{animate:{top:["0%","100%","0%"]},transition:{duration:2,repeat:1/0,ease:"linear"},className:"absolute left-0 right-0 h-0.5 bg-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.8)]"})]})}),e.jsx(k,{children:(b||o)&&e.jsx(g.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"absolute bottom-10 left-6 right-6 p-4 rounded-2xl bg-black/60 backdrop-blur-md text-white text-sm font-medium text-center border border-white/10",children:o?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(C,{className:"animate-spin",size:16}),"AI đang phân tích hình ảnh..."]}):e.jsx("div",{className:"text-rose-400",children:b})})}),e.jsx("button",{onClick:u,className:"absolute top-6 right-6 w-10 h-10 bg-black/40 backdrop-blur-md rounded-full flex items-center justify-center text-white",children:e.jsx(I,{size:20})})]}),e.jsxs("div",{className:"mt-8 flex items-center gap-6",children:[e.jsx("button",{onClick:f,className:"w-12 h-12 bg-white/10 text-white rounded-full flex items-center justify-center hover:bg-white/20 transition-colors",children:e.jsx(R,{size:20})}),e.jsx("button",{onClick:w,disabled:o,className:"w-20 h-20 bg-white rounded-full flex items-center justify-center shadow-xl active:scale-90 transition-transform disabled:opacity-50",children:e.jsx("div",{className:"w-16 h-16 border-4 border-stone-200 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 bg-black rounded-full"})})}),e.jsx("div",{className:"w-12"})," "]}),e.jsx("p",{className:"text-white/40 text-xs font-medium mt-6 text-center max-w-[200px]",children:"Căn chỉnh nhãn chai hoặc mã vạch vào khung hình để quét"}),e.jsx("canvas",{ref:h,className:"hidden"})]})};export{E as default};
